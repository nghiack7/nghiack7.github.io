<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Loan Interest Calculator</title>
    <link rel="stylesheet" href="/assets/css/main-CQfhAB3j.css">
    <link rel="stylesheet" href="/assets/css/dark-mode.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loan-calculator {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 1px solid var(--color-border);
            background: var(--color-background);
            color: var(--color-text);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .lang-btn.active {
            background: var(--color-primary);
            color: white;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .input-section, .dashboard-section {
            background: var(--color-card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-text);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background: var(--color-background);
            color: var(--color-text);
            font-size: 16px;
        }
        
        .loan-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .loan-type-card {
            padding: 15px;
            border: 2px solid var(--color-border);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .loan-type-card:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }
        
        .loan-type-card.selected {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .promotion-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .promotion-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .results-section {
            background: var(--color-card);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .result-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: var(--color-background);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid var(--color-primary);
        }
        
        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-primary);
            margin-bottom: 5px;
        }
        
        .result-label {
            color: var(--color-text-secondary);
            font-size: 14px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        
        .amortization-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .amortization-table th,
        .amortization-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid var(--color-border);
        }
        
        .amortization-table th {
            background: var(--color-primary);
            color: white;
        }
        
        .amortization-table tr:nth-child(even) {
            background: var(--color-background);
        }
        
        .floating-rate-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .floating-rate-info::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(33, 150, 243, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        .promotion-period-section {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 2px solid #ffa726;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .rate-transition-info {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border: 2px solid #9c27b0;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .timeline-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            position: relative;
        }
        
        .timeline-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #e0e0e0;
            z-index: 1;
        }
        
        .timeline-segment {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            z-index: 2;
            border: 2px solid #e0e0e0;
            flex: 1;
            margin: 0 5px;
        }
        
        .timeline-segment.active {
            border-color: #4caf50;
            background: #e8f5e8;
        }
        
        .timeline-segment.future {
            border-color: #ff9800;
            background: #fff3e0;
        }
        
        .penalty-section {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
            
            .loan-types {
                grid-template-columns: 1fr;
            }
            
            .result-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(200%) rotate(45deg); }
        }
        
        /* Pagination Styles */
        .pagination-controls {
            margin-top: 20px;
            padding: 20px;
            background: var(--color-card);
            border-radius: 10px;
            border: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .pagination-info {
            color: var(--color-text-secondary);
            font-size: 14px;
        }
        
        .pagination-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pagination-btn {
            padding: 8px 16px;
            border: 1px solid var(--color-border);
            background: var(--color-background);
            color: var(--color-text);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-numbers {
            display: flex;
            gap: 5px;
        }
        
        .page-number {
            padding: 8px 12px;
            border: 1px solid var(--color-border);
            background: var(--color-background);
            color: var(--color-text);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-width: 36px;
            text-align: center;
        }
        
        .page-number:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .page-number.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="lang-btn active" data-lang="vi">Tiáº¿ng Viá»‡t</button>
        <button class="lang-btn" data-lang="en">English</button>
    </div>

    <div class="loan-calculator">
        <div class="calculator-header">
            <h1 data-i18n="main-title">Bank Loan Interest Calculator</h1>
            <p data-i18n="subtitle">Calculate mortgage, personal, and collateral-free loans with dynamic rates</p>
        </div>

        <div class="calculator-grid">
            <div class="input-section">
                <h2 data-i18n="input-title">Loan Information</h2>
                
                <div class="loan-types">
                    <div class="loan-type-card selected" data-loan-type="mortgage">
                        <div data-i18n="mortgage">Mortgage</div>
                        <small data-i18n="mortgage-desc">Collateral loan</small>
                    </div>
                    <div class="loan-type-card" data-loan-type="personal">
                        <div data-i18n="personal">Personal</div>
                        <small data-i18n="personal-desc">Unsecured</small>
                    </div>
                    <div class="loan-type-card" data-loan-type="business">
                        <div data-i18n="business">Business</div>
                        <small data-i18n="business-desc">Collateral-free</small>
                    </div>
                </div>

                <div class="form-group">
                    <label data-i18n="loan-amount">Loan Amount (VND)</label>
                    <input type="number" id="loanAmount" value="500000000" min="1000000" step="1000000">
                </div>

                <div class="form-group">
                    <label data-i18n="loan-term">Loan Term (months)</label>
                    <input type="number" id="loanTerm" value="120" min="6" max="360">
                </div>

                <div class="form-group">
                    <label data-i18n="interest-type">Interest Type</label>
                    <select id="interestType">
                        <option value="fixed" data-i18n="fixed-rate">Fixed Rate</option>
                        <option value="floating" data-i18n="floating-rate">Floating Rate</option>
                    </select>
                </div>

                <div class="floating-rate-info hidden" id="floatingRateInfo">
                    <h4 data-i18n="floating-info">ðŸ“Š Floating Rate Information</h4>
                    <div class="form-group">
                        <label data-i18n="base-rate">Base Rate (%)</label>
                        <input type="number" id="baseRate" value="8.5" min="0" max="30" step="0.1">
                    </div>
                    <div class="form-group">
                        <label data-i18n="margin">Margin (%)</label>
                        <input type="number" id="margin" value="2.5" min="0" max="10" step="0.1">
                    </div>
                    
                    <div class="promotion-period-section">
                        <h5 data-i18n="promo-period-title">ðŸŽ¯ Promotional Fixed Period</h5>
                        <p data-i18n="promo-period-desc">Enjoy fixed promotional rate for initial period before floating rates apply</p>
                        <div class="form-group">
                            <label data-i18n="promo-duration">Promotional Duration (years)</label>
                            <select id="promoDuration">
                                <option value="0" data-i18n="no-promo">No Promotional Period</option>
                                <option value="2" selected>2 years</option>
                                <option value="3">3 years</option>
                                <option value="5">5 years</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="promo-rate">Promotional Rate (%/year)</label>
                            <input type="number" id="promoRate" value="7.5" min="0" max="30" step="0.1">
                        </div>
                    </div>
                    
                    <div class="rate-transition-info">
                        <h6 data-i18n="rate-transition">ðŸ“ˆ Rate Transition Timeline</h6>
                        <div class="timeline-indicator">
                            <div class="timeline-segment active">
                                <strong data-i18n="promo-phase">Promotional</strong><br>
                                <span id="promoMonths">24</span> <span data-i18n="months">months</span>
                            </div>
                            <div class="timeline-segment future">
                                <strong data-i18n="floating-phase">Floating</strong><br>
                                <span id="floatingMonths">96</span> <span data-i18n="months">months</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label data-i18n="interest-rate">Interest Rate (%/year)</label>
                    <input type="number" id="interestRate" value="9.5" min="0" max="30" step="0.1">
                </div>

                <div class="promotion-section">
                    <h3 data-i18n="promotion-title">ðŸŽ‰ Special Promotion</h3>
                    <p data-i18n="promotion-desc">Limited time offer! Get 0.5% discount on interest rates</p>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="applyPromotion"> 
                            <span data-i18n="apply-promotion">Apply Promotion Discount</span>
                            <span class="promotion-badge">-0.5%</span>
                        </label>
                    </div>
                </div>

                <div class="penalty-section">
                    <h3 data-i18n="penalty-title">Penalty Fees (Optional)</h3>
                    <div class="form-group">
                        <label data-i18n="early-payment">Early Payment Penalty (%)</label>
                        <input type="number" id="earlyPaymentPenalty" value="2" min="0" max="10" step="0.1">
                    </div>
                    <div class="form-group">
                        <label data-i18n="late-payment">Late Payment Penalty (%/month)</label>
                        <input type="number" id="latePaymentPenalty" value="5" min="0" max="20" step="0.1">
                    </div>
                </div>

                <button class="calculate-btn" data-i18n="calculate">Calculate Loan</button>
            </div>

            <div class="dashboard-section">
                <h2 data-i18n="dashboard-title">Loan Dashboard</h2>
                
                <div class="result-cards">
                    <div class="result-card">
                        <div class="result-value" id="monthlyPayment">-</div>
                        <div class="result-label" data-i18n="monthly-payment">Monthly Payment</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="totalInterest">-</div>
                        <div class="result-label" data-i18n="total-interest">Total Interest</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="totalPayment">-</div>
                        <div class="result-label" data-i18n="total-payment">Total Payment</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="effectiveRate">-</div>
                        <div class="result-label" data-i18n="effective-rate">Effective Rate</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="loanChart"></canvas>
                </div>
            </div>
        </div>

        <div class="results-section hidden" id="resultsSection">
            <h2 data-i18n="amortization-title">Amortization Schedule</h2>
            <div class="table-container">
                <table class="amortization-table" id="amortizationTable">
                    <thead>
                        <tr>
                            <th data-i18n="period">Period</th>
                            <th data-i18n="payment">Payment</th>
                            <th data-i18n="principal">Principal</th>
                            <th data-i18n="interest">Interest</th>
                            <th data-i18n="balance">Balance</th>
                        </tr>
                    </thead>
                    <tbody id="amortizationBody">
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination Controls -->
            <div class="pagination-controls" id="paginationControls" style="display: none;">
                <div class="pagination-info">
                    <span id="paginationInfo">Showing 1-12 of 0 entries</span>
                </div>
                <div class="pagination-buttons">
                    <button class="pagination-btn" id="prevBtn" onclick="changePage(-1)">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="page-numbers" id="pageNumbers"></div>
                    <button class="pagination-btn" id="nextBtn" onclick="changePage(1)">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/js/dark-mode.js"></script>
    <script>
        // Multi-language support
        const translations = {
            vi: {
                "title": "TÃ­nh LÃ£i Suáº¥t Vay Vá»‘n NgÃ¢n HÃ ng",
                "main-title": "CÃ´ng Cá»¥ TÃ­nh LÃ£i Suáº¥t Vay Vá»‘n",
                "subtitle": "TÃ­nh toÃ¡n khoáº£n vay tháº¿ cháº¥p, cÃ¡ nhÃ¢n, vÃ  tÃ­n cháº¥p vá»›i lÃ£i suáº¥t Ä‘á»™ng",
                "input-title": "ThÃ´ng Tin Khoáº£n Vay",
                "mortgage": "Tháº¿ cháº¥p",
                "mortgage-desc": "Vay cÃ³ tÃ i sáº£n Ä‘áº£m báº£o",
                "personal": "CÃ¡ nhÃ¢n", 
                "personal-desc": "Vay khÃ´ng tÃ i sáº£n Ä‘áº£m báº£o",
                "business": "Kinh doanh",
                "business-desc": "Vay tÃ­n cháº¥p",
                "loan-amount": "Sá»‘ Tiá»n Vay (VNÄ)",
                "loan-term": "Thá»i Háº¡n Vay (thÃ¡ng)",
                "interest-type": "Loáº¡i LÃ£i Suáº¥t",
                "fixed-rate": "LÃ£i Suáº¥t Cá»‘ Äá»‹nh",
                "floating-rate": "LÃ£i Suáº¥t Tháº£ Ná»•i",
                "floating-info": "ðŸ“Š ThÃ´ng Tin LÃ£i Suáº¥t Tháº£ Ná»•i",
                "base-rate": "LÃ£i Suáº¥t CÆ¡ Báº£n (%)",
                "margin": "BiÃªn Äá»™ (%)",
                "promo-period-title": "ðŸŽ¯ Ká»³ Khuyáº¿n MÃ£i Cá»‘ Äá»‹nh",
                "promo-period-desc": "Táº­n hÆ°á»Ÿng lÃ£i suáº¥t khuyáº¿n mÃ£i cá»‘ Ä‘á»‹nh trong thá»i gian Ä‘áº§u trÆ°á»›c khi Ã¡p dá»¥ng lÃ£i suáº¥t tháº£ ná»•i",
                "promo-duration": "Thá»i Háº¡n Khuyáº¿n MÃ£i (nÄƒm)",
                "no-promo": "KhÃ´ng CÃ³ Khuyáº¿n MÃ£i",
                "promo-rate": "LÃ£i Suáº¥t Khuyáº¿n MÃ£i (%/nÄƒm)",
                "rate-transition": "ðŸ“ˆ Lá»‹ch TrÃ¬nh Chuyá»ƒn Äá»•i LÃ£i Suáº¥t",
                "promo-phase": "Khuyáº¿n MÃ£i",
                "floating-phase": "Tháº£ Ná»•i",
                "months": "thÃ¡ng",
                "interest-rate": "LÃ£i Suáº¥t (%/nÄƒm)",
                "promotion-title": "ðŸŽ‰ Khuyáº¿n MÃ£i Äáº·c Biá»‡t",
                "promotion-desc": "Æ¯u Ä‘Ã£i giá»›i háº¡n! Giáº£m 0.5% lÃ£i suáº¥t",
                "apply-promotion": "Ãp Dá»¥ng Khuyáº¿n MÃ£i",
                "penalty-title": "PhÃ­ Pháº¡t (TÃ¹y Chá»n)",
                "early-payment": "PhÃ­ Tráº£ TrÆ°á»›c (%)",
                "late-payment": "PhÃ­ Tráº£ Cháº­m (%/thÃ¡ng)",
                "calculate": "TÃ­nh ToÃ¡n Khoáº£n Vay",
                "dashboard-title": "Báº£ng Äiá»u Khiá»ƒn Khoáº£n Vay",
                "monthly-payment": "Tráº£ HÃ ng ThÃ¡ng",
                "total-interest": "Tá»•ng LÃ£i",
                "total-payment": "Tá»•ng Thanh ToÃ¡n",
                "effective-rate": "LÃ£i Suáº¥t Hiá»‡u Quáº£",
                "amortization-title": "Lá»‹ch Tráº£ Ná»£",
                "period": "Ká»³",
                "payment": "Thanh ToÃ¡n",
                "principal": "Gá»‘c",
                "interest": "LÃ£i",
                "balance": "DÆ° Ná»£",
                "rate-header": "LÃ£i Suáº¥t (%)",
                "showing-first-12": "Hiá»ƒn thá»‹ 12 ká»³ Ä‘áº§u..."
            },
            en: {
                "title": "Bank Loan Interest Calculator",
                "main-title": "Loan Interest Calculator",
                "subtitle": "Calculate mortgage, personal, and collateral-free loans with dynamic rates",
                "input-title": "Loan Information",
                "mortgage": "Mortgage",
                "mortgage-desc": "Collateral loan",
                "personal": "Personal",
                "personal-desc": "Unsecured", 
                "business": "Business",
                "business-desc": "Collateral-free",
                "loan-amount": "Loan Amount (VND)",
                "loan-term": "Loan Term (months)",
                "interest-type": "Interest Type",
                "fixed-rate": "Fixed Rate",
                "floating-rate": "Floating Rate",
                "floating-info": "ðŸ“Š Floating Rate Information",
                "base-rate": "Base Rate (%)",
                "margin": "Margin (%)",
                "promo-period-title": "ðŸŽ¯ Promotional Fixed Period",
                "promo-period-desc": "Enjoy fixed promotional rate for initial period before floating rates apply",
                "promo-duration": "Promotional Duration (years)",
                "no-promo": "No Promotional Period",
                "promo-rate": "Promotional Rate (%/year)",
                "rate-transition": "ðŸ“ˆ Rate Transition Timeline",
                "promo-phase": "Promotional",
                "floating-phase": "Floating",
                "months": "months",
                "interest-rate": "Interest Rate (%/year)",
                "promotion-title": "ðŸŽ‰ Special Promotion",
                "promotion-desc": "Limited time offer! Get 0.5% discount on interest rates",
                "apply-promotion": "Apply Promotion Discount",
                "penalty-title": "Penalty Fees (Optional)",
                "early-payment": "Early Payment Penalty (%)",
                "late-payment": "Late Payment Penalty (%/month)",
                "calculate": "Calculate Loan",
                "dashboard-title": "Loan Dashboard",
                "monthly-payment": "Monthly Payment",
                "total-interest": "Total Interest",
                "total-payment": "Total Payment",
                "effective-rate": "Effective Rate",
                "amortization-title": "Amortization Schedule",
                "period": "Period",
                "payment": "Payment",
                "principal": "Principal",
                "interest": "Interest",
                "balance": "Balance",
                "rate-header": "Rate (%)",
                "showing-first-12": "Showing first 12 periods..."
            }
        };

        let currentLang = 'vi';
        let loanChart = null;
        
        // Pagination variables
        let allAmortizationData = [];
        let currentPage = 1;
        const rowsPerPage = 12;

        // Language switcher
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentLang = this.dataset.lang;
                updateLanguage();
            });
        });

        function updateLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.dataset.i18n;
                if (translations[currentLang][key]) {
                    element.textContent = translations[currentLang][key];
                }
            });
            
            // Update HTML lang attribute
            document.documentElement.lang = currentLang;
        }

        // Loan type selection
        document.querySelectorAll('.loan-type-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.loan-type-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                updateInterestRate();
            });
        });

        // Interest type change
        document.getElementById('interestType').addEventListener('change', function() {
            const floatingInfo = document.getElementById('floatingRateInfo');
            if (this.value === 'floating') {
                floatingInfo.classList.remove('hidden');
            } else {
                floatingInfo.classList.add('hidden');
            }
        });

        // Promo duration change
        document.getElementById('promoDuration').addEventListener('change', updateRateTimeline);
        
        // Loan term change
        document.getElementById('loanTerm').addEventListener('input', updateRateTimeline);
        
        function updateRateTimeline() {
            const loanTerm = parseInt(document.getElementById('loanTerm').value);
            const promoYears = parseInt(document.getElementById('promoDuration').value);
            const promoMonths = promoYears * 12;
            const floatingMonths = Math.max(0, loanTerm - promoMonths);
            
            document.getElementById('promoMonths').textContent = promoMonths;
            document.getElementById('floatingMonths').textContent = floatingMonths;
        }

        // Update interest rate based on loan type
        function updateInterestRate() {
            const selectedType = document.querySelector('.loan-type-card.selected').dataset.loanType;
            const rateInput = document.getElementById('interestRate');
            
            const rates = {
                mortgage: 8.5,
                personal: 12.5,
                business: 15.5
            };
            
            rateInput.value = rates[selectedType];
        }

        // Calculate loan
        document.querySelector('.calculate-btn').addEventListener('click', calculateLoan);

        function calculateLoan() {
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const loanTerm = parseInt(document.getElementById('loanTerm').value);
            const interestType = document.getElementById('interestType').value;
            
            let totalPayment = 0;
            let totalInterest = 0;
            let monthlyPayment = 0;
            let amortizationData = [];
            
            if (interestType === 'floating') {
                // Handle floating rate with promotional period
                const promoYears = parseInt(document.getElementById('promoDuration').value);
                const promoMonths = promoYears * 12;
                const promoRate = parseFloat(document.getElementById('promoRate').value);
                const baseRate = parseFloat(document.getElementById('baseRate').value);
                const margin = parseFloat(document.getElementById('margin').value);
                const floatingRate = baseRate + margin;
                
                // Apply promotion discount if checked
                let effectivePromoRate = promoRate;
                if (document.getElementById('applyPromotion').checked) {
                    effectivePromoRate -= 0.5;
                }
                
                let effectiveFloatingRate = floatingRate;
                if (document.getElementById('applyPromotion').checked) {
                    effectiveFloatingRate -= 0.5;
                }
                
                // Calculate payment for promotional period
                const promoMonthlyRate = effectivePromoRate / 100 / 12;
                const floatingMonthlyRate = effectiveFloatingRate / 100 / 12;
                
                // Use the higher rate for initial calculation to ensure coverage
                const initialMonthlyRate = Math.max(promoMonthlyRate, floatingMonthlyRate);
                monthlyPayment = loanAmount * (initialMonthlyRate * Math.pow(1 + initialMonthlyRate, loanTerm)) / (Math.pow(1 + initialMonthlyRate, loanTerm) - 1);
                
                // Calculate amortization with rate changes
                let balance = loanAmount;
                let currentMonthlyRate = promoMonthlyRate;
                
                for (let i = 1; i <= loanTerm; i++) {
                    // Switch to floating rate after promotional period
                    if (i > promoMonths) {
                        currentMonthlyRate = floatingMonthlyRate;
                    }
                    
                    const interestPayment = balance * currentMonthlyRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    balance -= principalPayment;
                    
                    totalPayment += monthlyPayment;
                    totalInterest += interestPayment;
                    
                    amortizationData.push({
                        period: i,
                        payment: monthlyPayment,
                        principal: principalPayment,
                        interest: interestPayment,
                        balance: Math.max(0, balance),
                        rate: currentMonthlyRate * 12 * 100
                    });
                }
                
            } else {
                // Handle fixed rate
                let interestRate = parseFloat(document.getElementById('interestRate').value);
                
                // Apply promotion discount
                if (document.getElementById('applyPromotion').checked) {
                    interestRate -= 0.5;
                }
                
                const monthlyRate = interestRate / 100 / 12;
                monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, loanTerm)) / (Math.pow(1 + monthlyRate, loanTerm) - 1);
                
                totalPayment = monthlyPayment * loanTerm;
                totalInterest = totalPayment - loanAmount;
                
                // Generate complete amortization
                let balance = loanAmount;
                for (let i = 1; i <= loanTerm; i++) {
                    const interestPayment = balance * monthlyRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    balance -= principalPayment;
                    
                    amortizationData.push({
                        period: i,
                        payment: monthlyPayment,
                        principal: principalPayment,
                        interest: interestPayment,
                        balance: Math.max(0, balance),
                        rate: interestRate
                    });
                }
            }
            
            const effectiveRate = (totalInterest / loanAmount / loanTerm * 12 * 100).toFixed(2);
            
            // Update dashboard
            document.getElementById('monthlyPayment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
            document.getElementById('totalPayment').textContent = formatCurrency(totalPayment);
            document.getElementById('effectiveRate').textContent = effectiveRate + '%';
            
            // Generate amortization schedule
            generateAmortizationSchedule(amortizationData);
            
            // Update chart
            updateChart(loanAmount, totalInterest, loanTerm);
            
            // Show results
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('fade-in');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        function generateAmortizationSchedule(amortizationData) {
            // Store all data for pagination
            allAmortizationData = amortizationData;
            currentPage = 1; // Reset to first page
            
            const tbody = document.getElementById('amortizationBody');
            tbody.innerHTML = '';
            
            // Check if we need to add rate column for floating rates
            const hasRateChanges = amortizationData.some(d => d.rate !== amortizationData[0]?.rate);
            
            if (hasRateChanges) {
                // Add rate column header
                const headerRow = document.querySelector('#amortizationTable thead tr');
                if (!headerRow.querySelector('[data-i18n="rate-header"]')) {
                    const rateHeader = document.createElement('th');
                    rateHeader.setAttribute('data-i18n', 'rate-header');
                    rateHeader.textContent = currentLang === 'vi' ? 'LÃ£i Suáº¥t (%)' : 'Rate (%)';
                    headerRow.appendChild(rateHeader);
                }
            }
            
            // Show pagination controls if more than 12 rows
            const paginationControls = document.getElementById('paginationControls');
            if (amortizationData.length > rowsPerPage) {
                paginationControls.style.display = 'flex';
            } else {
                paginationControls.style.display = 'none';
            }
            
            // Display current page
            displayCurrentPage();
        }
        
        function displayCurrentPage() {
            const tbody = document.getElementById('amortizationBody');
            tbody.innerHTML = '';
            
            const hasRateChanges = allAmortizationData.some(d => d.rate !== allAmortizationData[0]?.rate);
            
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = Math.min(startIndex + rowsPerPage, allAmortizationData.length);
            const pageData = allAmortizationData.slice(startIndex, endIndex);
            
            pageData.forEach((data, index) => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = data.period;
                row.insertCell(1).textContent = formatCurrency(data.payment);
                row.insertCell(2).textContent = formatCurrency(data.principal);
                row.insertCell(3).textContent = formatCurrency(data.interest);
                row.insertCell(4).textContent = formatCurrency(data.balance);
                
                if (hasRateChanges) {
                    const rateCell = row.insertCell(5);
                    rateCell.textContent = data.rate.toFixed(2) + '%';
                    
                    // Highlight rate change periods
                    const actualIndex = startIndex + index;
                    if (actualIndex > 0 && data.rate !== allAmortizationData[actualIndex - 1].rate) {
                        row.style.backgroundColor = currentLang === 'vi' ? '#fff3e0' : '#e8f5e8';
                        row.style.fontWeight = 'bold';
                    }
                }
            });
            
            // Update pagination info and controls
            updatePaginationControls();
        }
        
        function updatePaginationControls() {
            const totalPages = Math.ceil(allAmortizationData.length / rowsPerPage);
            const startIndex = (currentPage - 1) * rowsPerPage + 1;
            const endIndex = Math.min(currentPage * rowsPerPage, allAmortizationData.length);
            
            // Update info text
            document.getElementById('paginationInfo').textContent = 
                `Showing ${startIndex}-${endIndex} of ${allAmortizationData.length} entries`;
            
            // Update button states
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            
            // Update page numbers
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            // Show max 5 page numbers
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-number';
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }
        }
        
        function changePage(direction) {
            const totalPages = Math.ceil(allAmortizationData.length / rowsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                displayCurrentPage();
            }
        }
        
        function goToPage(page) {
            currentPage = page;
            displayCurrentPage();
        }

        function updateChart(principal, interest, term) {
            const ctx = document.getElementById('loanChart').getContext('2d');
            
            if (loanChart) {
                loanChart.destroy();
            }
            
            loanChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        translations[currentLang]['principal'] || 'Principal',
                        translations[currentLang]['total-interest'] || 'Total Interest'
                    ],
                    datasets: [{
                        data: [principal, interest],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + formatCurrency(context.raw);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        updateLanguage();
    </script>
</body>
</html>